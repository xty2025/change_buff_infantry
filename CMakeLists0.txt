cmake_minimum_required(VERSION 3.10)
project(AutoAim_with_calib_infantry)
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -O3")
message(STATUS "CMAKE_SOURCE_DIR: ${CMAKE_SOURCE_DIR}")
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/bin)
message(STATUS "CMAKE_RUNTIME_OUTPUT_DIRECTORY: ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}")

# third party libs
add_library(third_party_libs INTERFACE)
find_package(OpenCV REQUIRED)
find_package(Eigen3 REQUIRED)
find_package(Boost CONFIG REQUIRED COMPONENTS system)
find_package(spdlog CONFIG REQUIRED)
find_package(OpenVINO REQUIRED)
find_package(Ceres REQUIRED)
add_compile_definitions(GLOG_NO_ABBREVIATED_SEVERITIES)
target_link_libraries(third_party_libs INTERFACE Boost::system)
target_link_libraries(third_party_libs INTERFACE spdlog::spdlog)
target_link_libraries(third_party_libs INTERFACE openvino::runtime)
target_link_libraries(third_party_libs INTERFACE Ceres::ceres)
target_link_libraries(third_party_libs INTERFACE ${OpenCV_LIBS} Eigen3::Eigen)
target_include_directories(third_party_libs INTERFACE ${CMAKE_SOURCE_DIR} ${CMAKE_SOURCE_DIR}/utils/include ${CMAKE_SOURCE_DIR}/modules)

find_library(GXIAPI_LIB NAMES gxiapi)
if(GXIAPI_LIB)
    message(STATUS "Found GXIAPI_LIB: ${GXIAPI_LIB}")
    target_link_libraries(third_party_libs INTERFACE ${GXIAPI_LIB})
else()
    message(FATAL_ERROR "GXIAPI_LIB not found")
endif()

# modules
add_library(modules_libs INTERFACE)
add_subdirectory(modules/buff)
add_subdirectory(modules/driver)
add_subdirectory(modules/detector)
add_subdirectory(modules/controller)
add_subdirectory(modules/solver)
add_subdirectory(modules/predictor)
add_subdirectory(modules/tracker)
add_subdirectory(modules/replayer)
add_subdirectory(modules/RecordSolver)
target_link_libraries(modules_libs INTERFACE buff driver detector controller solver predictor tracker replayer recordsolver)

# executables
add_executable(AutoAim AutoAim.cpp)
target_link_libraries(AutoAim PRIVATE third_party_libs modules_libs)
add_executable(Calib Calib.cpp)
target_link_libraries(Calib PRIVATE third_party_libs modules_libs)

# New target: calib_infantry
add_executable(calib_infantry calib_infantry.cpp)
target_link_libraries(calib_infantry PRIVATE third_party_libs modules_libs ${OpenCV_LIBS})
